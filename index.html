<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Secure Cyber Scan</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ===== BASE ===== */
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #0a0a0a;
  color: orange;
  overflow: hidden;
}
.light {
  background: #f5f5f5;
  color: #111;
}

/* ===== HEADER ===== */
header {
  display: flex;
  justify-content: space-between;
  padding: 12px 16px;
  align-items: center;
}
#menuBtn {
  font-size: 26px;
  cursor: pointer;
}

/* ===== MENU ===== */
#menuPanel {
  position: absolute;
  top: 50px;
  right: 10px;
  background: #111;
  border-radius: 10px;
  padding: 10px;
  display: none;
}
#menuPanel button {
  display: block;
  width: 100%;
  margin: 6px 0;
}

/* ===== BUTTON ===== */
button {
  background: linear-gradient(45deg, orange, red);
  border: none;
  padding: 14px;
  border-radius: 10px;
  color: #000;
  font-weight: bold;
  box-shadow: 0 0 20px orange;
  transition: 0.3s;
}
button:hover {
  box-shadow: 0 0 40px red;
}

/* ===== SCANNER ===== */
#scanner {
  display: flex;
  justify-content: center;
  margin-top: 100px;
}

/* ===== CYBER GRID ===== */
canvas {
  position: fixed;
  inset: 0;
  z-index: -1;
}

/* ===== BUBBLES ===== */
.bubble {
  position: absolute;
  bottom: -20px;
  width: 6px;
  height: 6px;
  background: orange;
  border-radius: 50%;
  animation: bubble 6s linear infinite;
}
@keyframes bubble {
  from { transform: translateY(0); opacity: 1; }
  to { transform: translateY(-120vh); opacity: 0; }
}
</style>
</head>

<body class="dark cyber">

<header>
  <h2>SECURE SCAN</h2>
  <div id="menuBtn">⋮</div>
</header>

<div id="menuPanel">
  <button onclick="toggleMute()">Mute</button>
  <button onclick="toggleTheme()">Light / Dark</button>
  <button onclick="toggleCyber()">Cyber Mode</button>
</div>

<canvas id="grid"></canvas>

<div id="scanner">
  <button onclick="scanToken()">SCAN TOKEN</button>
</div>

<audio id="beep">
  <source src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQAAAAA=">
</audio>

<script>
/* ===== STATE ===== */
let muted = false;
let cyberOn = true;

/* ===== MENU ===== */
menuBtn.onclick = () => {
  menuPanel.style.display =
    menuPanel.style.display === "block" ? "none" : "block";
};

function toggleMute() {
  muted = !muted;
}
function toggleTheme() {
  document.body.classList.toggle("light");
}
function toggleCyber() {
  cyberOn = !cyberOn;
  grid.style.display = cyberOn ? "block" : "none";
}

/* ===== DEVICE FINGERPRINT (CLIENT LEVEL) ===== */
function fingerprint() {
  return btoa(
    navigator.userAgent +
    screen.width +
    screen.height +
    navigator.language
  );
}

/* ===== TOKEN SCAN + EXPIRY LOGIC ===== */
function scanToken() {
  if (!muted) beep.play();

  const raw = prompt("Paste Token JSON:");
  if (!raw) return;

  let token;
  try {
    token = JSON.parse(raw);
  } catch {
    alert("INVALID TOKEN FORMAT");
    return;
  }

  if (token.expiry !== "NONE" && Date.now() > token.expiry) {
    alert("❌ EXPIRED");
    return;
  }

  if (token.fp && token.fp !== fingerprint()) {
    alert("❌ DEVICE MISMATCH");
    return;
  }

  alert("✅ ACCESS GRANTED");
}

/* ===== CYBER GRID ANIMATION ===== */
const ctx = grid.getContext("2d");
function drawGrid() {
  grid.width = innerWidth;
  grid.height = innerHeight;
  ctx.clearRect(0,0,grid.width,grid.height);
  ctx.strokeStyle = "rgba(255,140,0,0.15)";
  for (let x=0;x<grid.width;x+=40){
    ctx.beginPath();ctx.moveTo(x,0);ctx.lineTo(x,grid.height);ctx.stroke();
  }
  for (let y=0;y<grid.height;y+=40){
    ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(grid.width,y);ctx.stroke();
  }
}
setInterval(drawGrid, 1200);

/* ===== BUBBLE FIX (NOT REMOVED) ===== */
setInterval(()=>{
  if(!cyberOn) return;
  const b=document.createElement("div");
  b.className="bubble";
  b.style.left=Math.random()*100+"vw";
  document.body.appendChild(b);
  setTimeout(()=>b.remove(),6000);
},600);
</script>

</body>
</html>
